<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Trambot</title>
        <link rel="icon" type="image/webp" href="{{ url_for('static', filename='img/logotipo.webp') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='CSS/perfil.css') }}">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="crossorigin=""></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    </head>
    <body>
        <header class="header" id="header">
            <img src="{{ url_for('static', filename='img/logotipo.webp') }}" height="50" width="50">
            <h1>Trambot</h1>
            <h3 id="paginactual">Perfil</h3>
            <nav id="menu">
                <ul>
                    <li>☰
                        <ul>
                            <li><a href="{{ url_for('catalog.index') }}">Inicio</a></li>
                            <li><a href="{{ url_for('catalog.servicio') }}">Servicios</a></li>
                            <li><a href="{{ url_for('catalog.contactos') }}">Contacto</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <a href="{{url_for('catalog.logout')}}"><button class="sesion">Cerrar Sesión</button></a>
        </header>
        <main>
            <div class="contenedor-main">
                <div class="usuario">
                    <img src="{{url_for('static', filename='img/logotipo.webp')}}" class="fotito" alt="foto de usuario">
                    <div class="usuario-info">
                        <h3>Datos de Usuario</h3>
                        {% block container %}
                            <p><strong>Usuario:</strong> {{current_user.nombre}}</p>
                        {% endblock %}
                    </div>
                </div>  
                {% block container2 %}
                <div class="datos-usuario" id="app">
    <h3>Suscripciones</h3>
    
    <!-- Panel 1: Padrón y Registro Civil -->
                    <div class="servicio" v-show="paginaActual === 1">
                        {% set panel_1 = namespace(encontrado=false) %}
                        {% for servicio in servicios %}
                            {% if servicio.servicio_id == 1 %}
                                {% set panel_1.encontrado = true %}
                                <p><strong>Padrón y Registro Civil:</strong> {{ servicio.nombre_servicio }} contratado ({{ servicio.costo }}€/{{ servicio.renovacion }})</p>
                                <a href="{{ url_for('catalog.cancelar_suscripcion', servicio_id=1) }}" 
                                onclick="return confirm('¿Estás seguro de cancelar esta suscripción?')">
                                    <button>Cancelar suscripción</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=1">
                                    <button>Mejorar a Essential</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=1">
                                    <button>Mejorar a Premium</button>
                                </a>
                            {% endif %}
                        {% endfor %}
                        {% if not panel_1.encontrado %}
                            <p><strong>Padrón y Registro Civil:</strong> No está contratado.</p>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8BYCsm3x3qNyuNTqUuaZY') }}?panel_id=1">
                                <button>Contratar Basic</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=1">
                                <button>Contratar Essential</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=1">
                                <button>Contratar Premium</button>
                            </a>
                        {% endif %}
                        
                        <div class="info">
                            <p class="descripcion1">
                            <br>- Certificado de empadronamiento
                            <br>- Alta / baja / cambio de domicilio
                            <br>- Certificados de nacimiento, matrimonio, defunción
                            <br>- Identificación electrónica (BakQ, DNIe)
                            <br>- buzón ciudadano / sugerencias
                            </p>
                        </div>
                    </div>

                    <!-- Panel 2: Licencias y Permisos -->
                   <div class="servicio" v-show="paginaActual === 2">
                        {% set panel_2 = namespace(encontrado=false) %}
                        {% for servicio in servicios %}
                            {% if servicio.servicio_id == 2 and not panel_2.encontrado %}
                                {% set panel_2.encontrado = true %}
                                <p><strong>Licencias y Permisos:</strong> {{ servicio.nombre_servicio }} contratado ({{ servicio.costo }}€/{{ servicio.renovacion }})</p>
                                <a href="{{ url_for('catalog.cancelar_suscripcion', servicio_id=2) }}" 
                                onclick="return confirm('¿Estás seguro de cancelar esta suscripción?')">
                                    <button>Cancelar suscripción</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=2">
                                    <button>Mejorar a Essential</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=2">
                                    <button>Mejorar a Premium</button>
                                </a>
                            {% endif %}
                        {% endfor %}
                        {% if not panel_2.encontrado %}
                            <p><strong>Licencias y Permisos:</strong> No está contratado.</p>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8BYCsm3x3qNyuNTqUuaZY') }}?panel_id=2">
                                <button>Contratar Basic</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=2">
                                <button>Contratar Essential</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=2">
                                <button>Contratar Premium</button>
                            </a>
                        {% endif %}
                        
                        <div class="info">
                            <p class="descripcion2">
                            - Licencia de obras menores<br>
                            - Licencia de actividad o apertura<br>
                            - Ocupación de vía pública / terrazas<br>
                            - Permiso para rodajes o eventos<br>
                            - Declaración responsable de guías turísticos
                            </p>
                        </div>
                    </div>

                    <!-- Panel 3: Economía e Impuestos -->
                    <div class="servicio" v-show="paginaActual === 3">
                        {% set panel_3 = namespace(encontrado=false) %}
                        {% for servicio in servicios %}
                            {% if servicio.servicio_id == 3 %}
                                {% set panel_3.encontrado = true %}
                                <p><strong>Economía e Impuestos:</strong> {{ servicio.nombre_servicio }} contratado ({{ servicio.costo }}€/{{ servicio.renovacion }})</p>
                                <a href="{{ url_for('catalog.cancelar_suscripcion', servicio_id=3) }}" 
                                onclick="return confirm('¿Estás seguro de cancelar esta suscripción?')">
                                    <button>Cancelar suscripción</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=3">
                                    <button>Mejorar a Essential</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=3">
                                    <button>Mejorar a Premium</button>
                                </a>
                            {% endif %}
                        {% endfor %}
                        {% if not panel_3.encontrado %}
                            <p><strong>Economía e Impuestos:</strong> No está contratado.</p>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8BYCsm3x3qNyuNTqUuaZY') }}?panel_id=3">
                                <button>Contratar Basic</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=3">
                                <button>Contratar Essential</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=3">
                                <button>Contratar Premium</button>
                            </a>
                        {% endif %}
                        
                        <div class="info">
                            <p class="descripcion3">
                            - Pago de IBI, IVTM, basura, terrazas<br>
                            - Declaración de la Renta<br>
                            - Certificados fiscales, censos, IVA<br>
                            - Becas y programas de prácticas
                            </p>
                        </div>
                    </div>

                    <!-- Panel 4: Movilidad y Transporte -->
                    <div class="servicio" v-show="paginaActual === 4">
                        {% set panel_4 = namespace(encontrado=false) %}
                        {% for servicio in servicios %}
                            {% if servicio.servicio_id == 4 %}
                                {% set panel_4.encontrado = true %}
                                <p><strong>Movilidad y Transporte:</strong> {{ servicio.nombre_servicio }} contratado ({{ servicio.costo }}€/{{ servicio.renovacion }})</p>
                                <a href="{{ url_for('catalog.cancelar_suscripcion', servicio_id=4) }}" 
                                onclick="return confirm('¿Estás seguro de cancelar esta suscripción?')">
                                    <button>Cancelar suscripción</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=4">
                                    <button>Mejorar a Essential</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=4">
                                    <button>Mejorar a Premium</button>
                                </a>
                            {% endif %}
                        {% endfor %}
                        {% if not panel_4.encontrado %}
                            <p><strong>Movilidad y Transporte:</strong> No está contratado.</p>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8BYCsm3x3qNyuNTqUuaZY') }}?panel_id=4">
                                <button>Contratar Basic</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=4">
                                <button>Contratar Essential</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=4">
                                <button>Contratar Premium</button>
                            </a>
                        {% endif %}
                        
                        <div class="info">
                            <p class="descripcion4">
                            - Multas y sanciones<br>
                            - Tarjeta de residente (zonas OTA)<br>
                            - Licencias de transporte<br>
                            - Certificado CAP<br>
                            - Autorizaciones especiales de transporte
                            </p>
                        </div>
                    </div>

                    <!-- Panel 5: Vivienda y Medio Ambiente -->
                    <div class="servicio" v-show="paginaActual === 5">
                        {% set panel_5 = namespace(encontrado=false) %}
                        {% for servicio in servicios %}
                            {% if servicio.servicio_id == 5 %}
                                {% set panel_5.encontrado = true %}
                                <p><strong>Vivienda y Medio Ambiente:</strong> {{ servicio.nombre_servicio }} contratado ({{ servicio.costo }}€/{{ servicio.renovacion }})</p>
                                <a href="{{ url_for('catalog.cancelar_suscripcion', servicio_id=5) }}" 
                                onclick="return confirm('¿Estás seguro de cancelar esta suscripción?')">
                                    <button>Cancelar suscripción</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=5">
                                    <button>Mejorar a Essential</button>
                                </a>
                                <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=5">
                                    <button>Mejorar a Premium</button>
                                </a>
                            {% endif %}
                        {% endfor %}
                        {% if not panel_5.encontrado %}
                            <p><strong>Vivienda y Medio Ambiente:</strong> No está contratado.</p>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8BYCsm3x3qNyuNTqUuaZY') }}?panel_id=5">
                                <button>Contratar Basic</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8CqCsm3x3qNyu2r4B9J7E') }}?panel_id=5">
                                <button>Contratar Essential</button>
                            </a>
                            <a href="{{ url_for('catalog.crear_suscripcion', price_id='price_1Sq8DRCsm3x3qNyu8nXutWZP') }}?panel_id=5">
                                <button>Contratar Premium</button>
                            </a>
                        {% endif %}
                        
                        <div class="info">
                            <p class="descripcion5">
                            - Solicitud de vivienda pública<br>
                            - Dependencia y ayudas familiares<br>
                            - Autorizaciones ambientales
                            </p>
                        </div>
                    </div>
                
                    <div class="botones">
                        <button class="Anterior" @click="anterior" :disabled="paginaActual === 1">Anterior</button>
                        <button class="Siguiente" @click="siguiente" :disabled="paginaActual === totalPaginas">Siguiente</button>
                    </div>
                </div>
              {% endblock %}  
                <div class="info-extra">
                <h3>Chat con Trambot</h3>
                <div id="chat">
                    <div id="messages"></div>
                    <input type="text" id="input" placeholder="Escribe algo y presiona Enter">
                </div>
            </div>
            </div>
            
                
        </main>

        <footer class="footer">
            <div class="ubicacion">
                <h2>Nuestra ubicacion</h2> 
                <div id="map"></div>
            </div>
            <div class="redes">
                <h2>Nuestras redes sociales</h2>
                <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="contacto">
                <h2>Formas de contacto</h2>
                <p>Email: trambot@gmail.com</p>
                <p>Num:+34 638 49 34 82</p>            
            </div>
            <div class="elementos">
                <p>© 2025 Trambot. Todos los derechos reservados. - <a href="#">Aviso legal</a> - <a href="#">Politica de cookies</a> - <a href="#">Terminos de uso</a> </p> 
            </div>
        </footer>
        <script src="{{ url_for('static', filename='JavaScript/chatbot.js') }}"></script>
        <script>

            // ----------------------------
            // Inicializar mapa Leaflet
            // ----------------------------
            const map = L.map('map').setView([43.320324, -1.972454], 16);

            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            const marker = L.marker([43.320324, -1.972454])
                .addTo(map)
                .bindPopup('<b>Trambot </b><br> Nuestra empresa <img src="img/empresa.webp" width="150px" height="100px">');

            marker.on('click', function() {
                marker.openPopup();
            });

            Vue.createApp({
                data() {
                    return {
                        paginaActual: 1,
                        totalPaginas: 5 
                    }
                },
                methods: {
                    siguiente() {
                        if (this.paginaActual < this.totalPaginas) this.paginaActual++;
                    },
                    anterior() {
                        if (this.paginaActual > 1) this.paginaActual--;
                    }
                }
            }).mount('#app')

        </script>
    </body>
</html>